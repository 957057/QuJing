<!DOCTYPE html>
<html>
<head>
    <title>曲境 - ${DisplayName}</title>
    <link href="/statics/font-awesome.min.css" rel="stylesheet">
    <link rel="icon" href="data:image/png;base64,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AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////B////AH///gA//+AAB/+AAAH+AAAAfAAAADwAAAA4AAAAHAAAAD4AAAB/wAAB//AAD//4AA//+AAf//wAP///AH///8P/////////5////+f////n////////////////////////////8=">
    <script type="text/javascript" src="/statics/jquery-2.0.2.min.js"></script>
</head>
<body>

<div class="headerCard">
    <h2>
        监控/执行 目标方法
    </h2>
</div>

<div class="bodyMain">
    <h2 style="text-align: center;">
        <img  class="icon" src="${IconBase64}" style="margin: auto 15px;">${DisplayName}(${ProcessID})
    </h2>

    <table border="1" align="center">
        <tr style="height: 40px;" >
            <td>目标方法所属类名</td>
            <td>${class}</td>
        </tr>
        <tr style="height: 40px;" >
            <td>目标方法</td>
            <td>${description}</td>
        </tr>
        <#list parametersTypes as param>
            <tr style="height: 40px;" >
                <td>参数类型</td>
                <td>${param.name}</td>
            </tr>
        </#list>
        <tr style="height: 40px;" >
            <td>返回值类型</td>
            <td>${returnType.name}</td>
        </tr>
    </table>
</div>

<div class="bodyMain">
    <h2 style="text-align: center;">执行方法</h2>
    <form id="form_invoke">
        <input type=hidden name=class value=${class}>
        <input type=hidden name=method value=${method}>
        <table border="1" align="center">
            <tr style="height: 40px;" >
                <td>选择实例<i class="fa fa-info-circle" style="color: #666;margin-left: 5px;" title="static方法不需要实例，直接选择Null即可，非static方法需要指定实例，如果没有实例，在应用中操作一下，下面监控到之后会保存实例并传上来的。"></i>
                </td>
                <td>
                    <select id="thisobj" name=thisobj value=null>
                        <#list objList as obj>
                        <option value=${obj} selected = "selected">${obj}</option>
                        </#list>
                    <option value=null>Null</option>
                    </select>
                </td>
            </tr>
        <#list parametersTypes as param>
            <tr style="height: 40px;" >
                <td>参数${param_index}: ${param.name}</td>
                <td>
                    <input type=text name=param${param_index} value="" style="height: 23px;width: 300px;">
                    <select name=parser${param_index}>
                        <option value=string>String</option>
                        <option value=Context>Context</option>
                        <option value=int>Integer</option>
                        <option value=short>Short</option>
                        <option value=long>Long</option>
                        <option value=float>Float</option>
                        <option value=double>Double</option>
                        <option value=boolean>Boolean</option>
                        <option value=byte>Byte(in Base64)</option>
                        <option value=StringArray>String[](in JSON)</option>
                        <option value=StringArrayList>List&lt;String&gt;(in JSON)</option>
                        <option value=StringMap>Map&lt;String, Object&gt;(in JSON)</option>
                        <!--<option value=object>Object</option>-->
                        <option value=null>Null</option>
                    </select>
                </td>
            </tr>
        </#list>
        </table>
    </form>
    <button id="invoke" value="Invoke" style="display: block;text-align: center;margin: 20px auto; height: 30px; width: 90px;">
        <i class="fa fa-info-circle" style="color: #666;margin-right: 5px;" title="Context和Null类型不用填内容，其他类型均需要填内容。byte数据需要base64转换后填入，List和Map需要用Json格式。"></i>
        执行
    </button>
    <div id="invokeresult" style="padding: 10px;display: none;width:602px;margin: 30px auto 50px auto;background: #ddf;border: 1px solid blue;">

    </div>
</div>

<div class="bodyMain">
    <h2 style="text-align: center;">
        <i class="fa fa-info-circle" style="color: #666;margin-right: 5px;" title="在应用内操作后，触发到该函数便会输出到监控中。"></i>
        监控方法
    </h2>
    <div id="message"></div>
</div>
<footer style="margin: 30px auto 5px auto;text-align: center;color: #ccc;font-size: 13px;">
    <p><a href="https://github.com/Mocha-L/QuJing" target="_blank" >曲境</a>由<a href="https://github.com/Mocha-L/" target="_blank" >Mocha-Lee</a>倾<i class="heart" style="color: #FF3B30;font-family: FontAwesome;font-style: normal;"></i>奉献</p>
    <p>欢迎关注微信公众号“燕幕自安”（知识星球:爬虫三十六计）与我沟通交流</p>
    <style type="text/css">
                .heart:before {
                    content: "\f004";
                }
            </style>
</footer>
</body>
<script type="text/javascript">
        $.noConflict();
        jQuery(document).ready(function() {
            jQuery("#invoke").click(function(){
                jQuery.ajax({
                    type: 'POST',
                    data: jQuery('#form_invoke').serialize(),
                    url: '/invoke',
                    cache:false,
                    contentType:'application/x-www-form-urlencoded',
                    dataType:'text',
                    success: function (data) {
                        console.log(data);
                        var classresult=document.getElementById('invokeresult');
                        classresult.style.display="";
                        classresult.innerHTML="";
                        var e = document.createElement("h3");
                        e.innerHTML = "执行结果";
                        classresult.appendChild(e);
                        var obj=document.createElement("p");
                        obj.innerHTML="<p style=\"margin: 10px 40px;word-break: break-all;\" >" + data + "</p>";
                        classresult.appendChild(obj);
                    }
                })
            });
        });
</script>
<script type="text/javascript">
    var websocket = null;
    var Datum={};
    var messages="";
    //判断当前浏览器是否支持WebSocket
    if ('WebSocket' in window) {
        websocket = new WebSocket(document.location.origin.replace("http","ws")+"/methodview?class=${class}&method=${method}&javaname=${javaName}");
    }
    else {
        alert('当前浏览器不支持 websocket');
        console.error('当前浏览器不支持 websocket');
    }

    //连接发生错误的回调方法
    websocket.onerror = function () {
        setMessageInnerHTML("WebSocket连接发生错误");
    };

    //连接成功建立的回调方法
    websocket.onopen = function () {
        setMessageInnerHTML("<p>WebSocket连接成功</p>");
    }

    //接收到消息的回调方法
    websocket.onmessage = function (event) {
        data=JSON.parse(event.data);
        if(data.op=="msg")setMessageInnerHTML(data.msg);
        else if(data.op="updatethis")updatethis(data.data);
        else if(data.op=="data"){
            Datum[data.dataname]=data.data;
            console.log(Datum[data.dataname]);
            }
    }

    //连接关闭的回调方法
    websocket.onclose = function () {
        setMessageInnerHTML("WebSocket连接关闭");
    }

    //监听窗口关闭事件，当窗口关闭时，主动去关闭websocket连接，防止连接还没断开就关闭窗口，server端会抛异常。
    window.onbeforeunload = function () {
        closeWebSocket();
    }

    //将消息显示在网页上
    function setMessageInnerHTML(innerHTML) {
        document.getElementById('message').innerHTML = document.getElementById('message').innerHTML + innerHTML;
    }

    function updatethis(data) {
        document.getElementById('thisobj').innerHTML = "";
        for (i = 0; i < data.length; i++) {
            var obj=document.createElement("option");
            obj.value=data[i];
            obj.text=data[i];
            document.getElementById('thisobj').appendChild(obj);
        }
        document.getElementById('thisobj').innerHTML += "<option value =null>Null</option>";
    }
    //关闭WebSocket连接
    function closeWebSocket() {
        websocket.close();
    }

    //发送消息
    function send() {
        var message = document.getElementById('text').value;
        websocket.send(message);
    }
</script>
<style type="text/css">
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Microsoft YaHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'WenQuanYi Micro Hei', sans-serif;
            font-size: 15px;
            color: #1A1A1A;
            background: #F6F6F6;
            -webkit-tap-highlight-color: rgba(26, 26, 26, 0);
        }

        td {
            display: table-cell;
            vertical-align: inherit;
            padding: 0 15px;
        }

        .right{position:fixed; right:0;}

        img.icon{
            height: 30px;
            width: 30px;
            vertical-align: middle;
        }

        table{
            border-collapse:collapse;
            border:none;
        }

        .bodyMain {
            width: 80%;
            margin: 40px auto;
            background: #FFF;
            padding: 20px;
            border-bottom: 2px solid #ccc;
        }


        .headerCard {
            margin-bottom: 10px;
            background: #FFF;
            overflow: hidden;
            border-radius: 2px;
            box-shadow: 0 1px 3px rgba(26, 26, 26, 0.1);
            box-sizing: border-box;
            transition: box-shadow 300ms;
            text-align: center;
        }

        .question {
            margin: 20px 0 10px 0;
            font-size: 18px;
            font-weight: bold
        }

        .answer {
            margin: 10px 0 20px 0;
            font-size: 15px;
            color: #666;
        }
    </style>
</html>